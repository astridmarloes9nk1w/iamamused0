#!/bin/bash

. vender/scripts/get_env.sh --source-only

get_build_env "$@";

inform()
{
	echo ""
	echo "submodule vender is not existed!"
	echo "you can execute the given command to init and update it."
	echo " \$ git submodule init"
	echo " \$ git submodule update"
	echo ""
	exit 1
}

export BUILD_JOBS
export BUILD_VERBOSE

if [ -d vender ]; then 
	if [ -z $USE_VENDER_DIST ]; then
		cd vender
		sh build $BUILD_TYPE $TARGET_ARCH
		if [ $? != 0 ]; then
			exit 1
		fi
		cd ..
	fi
else
	inform
fi

cd fibjs
sh build $BUILD_TYPE $TARGET_ARCH $CI
if [ $? != 0 ]; then
	exit 1
fi
cd ..

cd fibjs/program
sh build $BUILD_TYPE $TARGET_ARCH $CI
if [ $? != 0 ]; then
	exit 1
fi
cd ../..

txtbld=$(tput bold)
bldred=${txtbld}$(tput setaf 1)
txtrst=$(tput sgr0)

printf "\n\n"
printf "\t${bldred} _______ _________ ______  _________ _______ ${txtrst}\n"
printf "\t${bldred}(  ____ \\\\\\__   __/(  ___ \\ \\__    _/(  ____ \\\\${txtrst}\n"
printf "\t${bldred}| (    \\/   ) (   | (   ) )   )  (  | (    \\/${txtrst}\n"
printf "\t${bldred}| (__       | |   | (__/ /    |  |  | (_____ ${txtrst}\n"
printf "\t${bldred}|  __)      | |   |  __ (     |  |  (_____  )${txtrst}\n"
printf "\t${bldred}| (         | |   | (  \\ \\    |  |        ) |${txtrst}\n"
printf "\t${bldred}| (_     ___) (___| (___) )/\\_)  )  /\\____) |${txtrst}\n"
printf "\t${bldred}(__/     \\_______/(______/ \\____/   \\_______)${txtrst}\n"
printf ""

printf "\\n\\tFIBJS has been successfully built.\\n\\n"

printf "\\tFor more information:\\n\\n"
printf "\\twebsite: http://fibjs.org\\n"
printf "\\trepository: https://github.com/fibjs\\n"
printf "\n\n"